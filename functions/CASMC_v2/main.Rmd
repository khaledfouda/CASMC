---
title: "Testing the new model"
output: html_document
---

# Load Libraries

```{r load-libraries, message=FALSE, warning=FALSE}
setwd("/mnt/campus/math/research/kfouda/main/HEC/Youssef/HEC_MAO_COOP")
source("./code_files/import_lib.R")
```

## r will be set to 16 for all tests and dimensions 800x900

## Test 1: 5 covariates, no collineatity. 100% informative

```{r}

dat <-
 generate_simulation_rows(
  800,
  900,
  r = 5,
  k = 5, 
  missing_prob = 0.9,
  coll = F,
  prepare_for_fitting = TRUE,
  half_discrete = FALSE,
  informative_cov_prop = 1,
  mv_beta = T,
  seed = 2023
 )



CASMC2_fit2(y = dat$fit_data$train,
            X = dat$X,
            svdH = NULL,
            Xterms = NULL,
            J = 3,
            r = 5,
            lambda.M = 8.7,
            lambda.beta = 10,
            # similarity matrix for A
            S.a = NULL,
            lambda.a = 0,
            # similarity matrix for B
            S.b = NULL,
            lambda.b = 0,
            maxit = 50,
            thresh = 1e-05,
            trace.it = T,
            warm.start = NULL,
            final.svd = F,
            init = "naive",
            Qtype = 1,
            qiter.max = 10,
            min_eigv = 1e-17) ->
  fiti



fiti$beta = as.matrix(fiti$ub %*% (fiti$db^2) %*% t(fiti$vb))
print_performance(dat, fiti, error_metric$rmse, F, "CASMC(Rank)",F,3)



```

